pipeline:
  steps:
    - name: Build
      image: golang:1.22.1
      branch: dev
      commands:
        - go mod download
        - go mod verify
        - go build -v -o cicd-service-go ./cmd/app

    - name: Test
      image: golang:1.22.1
      branch: dev
      commands:
        - go test -v ./...

    - name: Build docker image
      image: docker:latest
      branch: dev
      commands:
        - docker build -t cicd-service-go:latest .
        - docker tag cicd-service-go:latest registry:5000/cicd-service-go:latest
        - docker push registry:5000/cicd-service-go:latest

#    - name: Push docker image
#      image: docker:latest
#      branch: dev
#      commands:
#        - docker tag registry:5000/cicd-service-go:latest test/cicd-service-go:latest
#        - docker push registry:5000/cicd-service-go:latest
#
#    - name: Deploy
#      image:
#      branch: dev
#      commands:
#        - ./deploy.sh
